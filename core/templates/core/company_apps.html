{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Company Applications</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body { background:#f4f6f9; }
    .page-title { font-weight:800; letter-spacing:.2px; }

    .card-soft {
      border: 0;
      border-radius: 20px;
      box-shadow: 0 12px 30px rgba(0,0,0,.08);
      overflow: hidden;
    }

    .badge-soft {
      background: rgba(13,110,253,.12);
      color:#0d6efd;
      border: 1px solid rgba(13,110,253,.18);
      font-weight: 600;
      border-radius: 999px;
      padding: .35rem .6rem;
    }

    .muted { color:#6c757d; }
    .app-meta small { display:block; }
    hr { opacity: 0.1; }

    /* ---------- Search ---------- */
    .search-wrap input {
      border-radius: 14px;
      padding: 12px 14px;
    }

    /* ---------- File Pills ---------- */
    .file-pill {
      border: 1px solid #e6e9ef;
      border-radius: 14px;
      padding: 12px 14px;
      background: #fff;
      height: 100%;
    }

    .file-pill .file-name {
      font-size: 0.85rem;
      color: #6c757d;
      max-width: 240px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .file-pill .file-kind {
      font-weight: 800;
      font-size: 0.95rem;
      line-height: 1.15;
    }

    .file-pill .btn {
      padding: 6px 14px;
      font-size: 0.85rem;
      border-radius: 999px;
      white-space: nowrap;
    }

    .file-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      background: rgba(13,110,253,.10);
      border: 1px solid rgba(13,110,253,.14);
      flex: 0 0 auto;
    }

    .file-icon i {
      font-size: 1.35rem;
      color: #0d6efd;
    }
  </style>
</head>

<body>
<div class="container py-5">

  <!-- Header -->
  <div class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4">
    <div>
      <h2 class="page-title mb-1">Approved Applications</h2>
      <div class="muted">Download resume / work history / video for approved candidates</div>
    </div>

    <div class="d-flex gap-2">
      <a href="{% url 'company_logout' %}" class="btn btn-outline-danger">
        Logout
      </a>
    </div>
  </div>

  <!-- Empty State -->
  {% if not apps %}
    <div class="card card-soft">
      <div class="card-body p-5 text-center">
        <h4 class="mb-2">No approved applications yet</h4>
        <p class="muted mb-0">When admin approves applications, they will appear here.</p>
      </div>
    </div>
  {% else %}

    <!-- Search (client-side UI only) -->
    <div class="card card-soft mb-4">
      <div class="card-body p-3 p-md-4">
        <div class="row g-2 align-items-center search-wrap">
          <div class="col-md-6">
            <input id="appSearch" type="text" class="form-control" placeholder="Search by name, email, position..." />
          </div>
          <div class="col-md-6 text-md-end muted">
            Total: <span id="totalCount">{{ apps|length }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Applications List -->
    <div class="row g-4" id="appList">
      {% for app in apps %}
        <div class="col-12">
          <div class="card card-soft">
            <div class="card-body p-4 p-md-5">

              <div class="d-flex flex-wrap justify-content-between align-items-start gap-3">
                <!-- Left -->
                <div class="app-meta">
                  <h5 class="mb-2">
                    {{ app.applicant_name }}
                    <span class="badge badge-soft ms-2">ID #{{ app.id }}</span>
                  </h5>

                  <small class="muted">
                    <strong>Email:</strong> {{ app.applicant_email }}
                  </small>

                  {% if app.position %}
                    <small class="muted"><strong>Position:</strong> {{ app.position }}</small>
                  {% endif %}

                  <small class="muted">
                    <strong>Location:</strong> {{ app.location }}
                    &nbsp; â€¢ &nbsp;
                    <strong>Visa:</strong> {{ app.get_visa_type_display }}
                  </small>

                  <small class="muted">
                    <strong>Submitted:</strong> {{ app.created_at }}
                  </small>
                </div>

                <!-- Right -->
                <div class="text-end">
                  {% if app.company %}
                    <div class="muted"><small>Company: <strong>{{ app.company.name }}</strong></small></div>
                  {% endif %}
                </div>
              </div>

              <hr class="my-4"/>

              <!-- Files -->
              <div class="row g-3 mt-1">
                {% for f in app.files.all %}
                  <div class="col-12 col-md-4">
                    <div class="file-pill d-flex align-items-center justify-content-between gap-3">

                      <div class="d-flex align-items-center gap-3 flex-grow-1 overflow-hidden">
                        <!-- ICON BOX -->
                        <div class="file-icon">
                          {% if f.kind == "cv" %}
                            <i class="bi bi-file-earmark-person"></i>
                          {% elif f.kind == "work" %}
                            <i class="bi bi-file-earmark-bar-graph"></i>
                          {% elif f.kind == "video" %}
                            <i class="bi bi-camera-video"></i>
                          {% else %}
                            <i class="bi bi-file-earmark"></i>
                          {% endif %}
                        </div>

                        <!-- TEXT -->
                        <div class="overflow-hidden">
                          <div class="file-kind">
                            {{ f.get_kind_display }}
                          </div>
                          <div class="file-name">
                            {{ f.file.name|default:"file" }}
                          </div>
                        </div>
                      </div>

                      <!-- DOWNLOAD -->
                      <a class="btn btn-primary btn-sm"
                         href="{% url 'company_download' f.id %}">
                        <i class="bi bi-download me-1"></i> Download
                      </a>

                    </div>
                  </div>
                {% empty %}
                  <div class="col-12">
                    <div class="muted">No files uploaded.</div>
                  </div>
                {% endfor %}
              </div>

              {% if app.review_note %}
                <div class="mt-4">
                  <div class="fw-semibold mb-2">Admin Note</div>
                  <div class="p-3 rounded-3" style="background:#f8f9fa; border:1px solid #eef1f5;">
                    {{ app.review_note|linebreaksbr }}
                  </div>
                </div>
              {% endif %}

            </div>
          </div>
        </div>
      {% endfor %}
    </div>

  {% endif %}
</div>

<script>
  // simple client-side search (UI only, no backend change)
  const input = document.getElementById('appSearch');
  const list = document.getElementById('appList');

  if (input && list) {
    input.addEventListener('input', () => {
      const q = input.value.toLowerCase().trim();
      const cols = list.querySelectorAll('.col-12');
      let shown = 0;

      cols.forEach(col => {
        const txt = col.innerText.toLowerCase();
        const ok = txt.includes(q);
        col.style.display = ok ? '' : 'none';
        if (ok) shown++;
      });

      const total = document.getElementById('totalCount');
      if (total) total.textContent = shown;
    });
  }
</script>

</body>
</html>
